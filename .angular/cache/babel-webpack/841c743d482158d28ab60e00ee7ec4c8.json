{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"angularfire2/auth\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"./message.service\";\nexport let UserService = /*#__PURE__*/(() => {\n  class UserService {\n    constructor(firebaseAuth, router, http, messageService) {\n      this.firebaseAuth = firebaseAuth;\n      this.router = router;\n      this.http = http;\n      this.messageService = messageService;\n      this.defaultProfilePhoto = \"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png\";\n      this.user = firebaseAuth.authState;\n      console.log(\"user id token at construction of service\", localStorage.getItem('userIdToken'));\n      this.user.subscribe(userInfo => {\n        console.log(\"user info is available\", userInfo);\n        if (userInfo !== null) this.saveIdToken(userInfo);\n      });\n    }\n\n    canActivate() {\n      if (this.firebaseAuth.auth.currentUser != null) {\n        return true;\n      }\n\n      this.router.navigate(['login']);\n      return false;\n    }\n\n    saveIdToken(firebaseUser) {\n      if (firebaseUser != null) firebaseUser.getIdToken().then(idTokenValue => {\n        localStorage.setItem('userIdToken', idTokenValue);\n        console.log(\"Id Token Value:\", localStorage.getItem('userIdToken'));\n      });\n    }\n\n    signup(email, password, name) {\n      this.firebaseAuth.auth.createUserWithEmailAndPassword(email, password).then(value => {\n        console.log('Success signup', value);\n        console.log(\"Name in signup\", name);\n        this.saveIdToken(value.user);\n        this.registerUser(email, name);\n      }).catch(err => {\n        console.log('Something went wrong:', err.message);\n        this.messageService.newMessage(err.message);\n      });\n    }\n\n    registerUser(email, name) {\n      console.log(\"Name in registration\", name);\n      var user = {\n        emailAddress: email,\n        name: name,\n        profilePicUrl: this.defaultProfilePhoto,\n        id: \"\"\n      };\n      var headers = this.getHeaders();\n      this.http.post(\"http://65.0.100.164:8080/api/users/addNewUser\", user, {\n        headers\n      }).subscribe(response => {\n        console.log('Success registration');\n        this.router.navigate(['albums/recent']);\n      });\n    }\n\n    login(email, password) {\n      this.firebaseAuth.auth.signInWithEmailAndPassword(email, password).then(value => {\n        console.log('Nice, it worked!');\n        this.saveIdToken(value.user);\n        this.router.navigate(['albums/recent']);\n      }).catch(err => {\n        console.log('Something went wrong:', err.message);\n        this.messageService.newMessage(err.message);\n      });\n    }\n\n    logout() {\n      localStorage.clear();\n      this.firebaseAuth.auth.signOut();\n      this.router.navigate(['login']);\n    }\n\n    getCurrentUserProfile() {\n      var headers = this.getHeaders();\n      return this.http.get(\"http://65.0.100.164:8080/api/users/me\", {\n        headers\n      }); //return this.http.get(\"http://65.0.100.164:8080/api/users/findByName?name=\", name);\n      //return this.http.get(\"http://65.0.100.164:8080/api/users/?id=\",{headers}); \n    }\n\n    getHeaders() {\n      var headers = {\n        'idToken': localStorage.getItem('userIdToken') || '{}'\n      };\n      return headers;\n    }\n\n  }\n\n  UserService.ɵfac = function UserService_Factory(t) {\n    return new (t || UserService)(i0.ɵɵinject(i1.AngularFireAuth), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.HttpClient), i0.ɵɵinject(i4.MessageService));\n  };\n\n  UserService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: UserService,\n    factory: UserService.ɵfac,\n    providedIn: 'root'\n  });\n  return UserService;\n})();","map":null,"metadata":{},"sourceType":"module"}